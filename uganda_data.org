* Ugandan LSMS Data
The following sets up a dataframe from Ugandan data; it relies on code
from =Data/LSMS/Uganda/MANIFEST.org= to create a pickled pd.DataFrame
=Data/LSMS/Uganda/tmp/uganda.df=; also on a file =Data/Uganda/expenditure_codes= which
provides a mapping of codes for different expenditure items into
particular food categories.  

The argument "expenditures" should be set to a string describing a
particular set of goods.

#+name: uganda_data
#+begin_src python :noweb no-export :var expenditures="foodgroups0" :results output raw table :tangle uganda_data.py
  import pandas as pd
  import numpy as np
  import sys
  sys.path.append('../Data/Uganda')
  sys.path.append('../Empirics')
  import neediness as nd

  exps=pd.read_pickle('../Data/Uganda/expenditure_codes.pickle')

  try:
      df=pd.read_pickle('../Data/Uganda/uganda.df')
      prices=pd.read_pickle('../Data/Uganda/food_prices.df')
  except IOError:
      print "Need to build ../Data/{uganda,food_prices}.df (using code in LSMS/Uganda/MANIFEST.org)."

  expdf=nd.group_expenditures(df,exps)

  expdf=expdf.replace(0,np.nan) # Zeros to NaN

  # Drop goods where too few observations to reliable estimate covariance matrix
  expdf=nd.drop_columns_wo_covariance(expdf,min_obs=30,VERBOSE=False)

  try:
      df['Rural']=(~df['urban']).astype('int32')
  except TypeError: # String instead of number?
      df['Rural']=df['urban'].apply(lambda s: s.lower()=='rural').astype('int32')

  mydf=expdf.copy()
  mydf['HHSIZE']=df[['boys','girls','women','men']].sum(axis=1)
  mydf['HHSIZE'].replace(to_replace=[0],value=[np.NaN],inplace=True)
  mydf['log HSize']=np.log(mydf['HHSIZE'])
  mydf['Boys']=df['boys']
  mydf['Girls']=df['girls']
  mydf['Women']=df['women']
  mydf['Men']=df['men']

  mydf['Rural']=df['Rural']
  #mydf=balance_panel(mydf)

  # Order so year is second level
  mydf.index.set_names(['t','j'],inplace=True)
  mydf.index=mydf.index.reorder_levels([1,0])

  mydf.sortlevel(level=0,inplace=True)

  z=mydf[['Boys','Girls','Men','Women','log HSize','Rural']]
  z=mydf[['Boys','Girls','Men','Women','log HSize']]
 
  y=np.log(mydf[expdf.columns])

  ####################################
  # Now set up market prices
  # Define numeraire good here!  If None, use natural price index

  market_index='Rural' # Variable indicating what market hh is in.
  numeraire = 'Rice'

  market=pd.Series(mydf[market_index],name='market')
  prices.index=prices.index.reorder_levels([1,0,2]) # Make index order match prices

  # Choose one...
  prices = prices['market'] # Only use market prices
  #prices = prices[['farmgate','market']].sum(axis=1) # Use both mkt & farmgate prices

  prices.index.names=['j','t','Item']

  pricedf=nd.group_expenditures(prices.unstack(),exps)
  pricedf=pricedf.replace(0,np.nan) # Zeros to NaN

  pricedf['market'] = market

  # Also give prices for good to be declared numeraire.
  # E.g., here are median rice prices and onion prices in different years from LSMS/Uganda/MANIFEST.org:
  market_prices = pricedf.reset_index().groupby(['t','market']).median()

#+end_src


* Generic Code
#+name: setup
#+begin_src python :exports none
import pylab as pl
import pandas as pd
import numpy as np
import sys
import cycler
import matplotlib as mpl

#mpl.style.use(['fivethirtyeight','bw']) 

#+end_src


